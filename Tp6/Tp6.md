# Requêtes SQL - Création de Tables, Insertion de Données et Vues

Ce document décrit la création des tables `Client_a` et `Visionnage_a`, l'insertion de données utilisateur, ainsi que la création et la manipulation de vues SQL.

```sql
-- Suppression des tables existantes `Client_a` et `Visionnage_a`
DROP TABLE Visionnage_a CASCADE CONSTRAINTS;
DROP TABLE Client_a CASCADE CONSTRAINTS;

-- Suppression des vues existantes
DROP VIEW vvFilm;
DROP VIEW vRealisateur;
DROP VIEW vvAuj;
DROP VIEW vFilmAtt;
DROP VIEW vClient;

-- 1. Création des tables `Client_a` et `Visionnage_a`

-- Création de la table `Client_a`
CREATE TABLE Client_a
(
    id_Client NUMBER(6) PRIMARY KEY,
    prenomClient VARCHAR(20),
    nomClient VARCHAR(20),
    planClient VARCHAR(50) DEFAULT 'Essentiel avec publicité' 
        CHECK(planClient IN ('Essentiel avec publicité', 'Essentiel', 'Standard', 'Supérieur', 'Premium'))
);

-- Création de la table `Visionnage_a`
CREATE TABLE Visionnage_a
(
    id_Client NUMBER(6),
    horoDatageDebut TIMESTAMP,
    idFilm NUMBER(10) NOT NULL,
    numVersion NUMBER(1) NOT NULL,
    minuteStop NUMBER(10),
    horoDatageFin TIMESTAMP,
    PRIMARY KEY (id_Client, horoDatageDebut),
    FOREIGN KEY (id_Client) REFERENCES Client_a(id_Client) ON DELETE CASCADE
);

-- 2. Insertion des données dans `Client_a`
INSERT INTO Client_a VALUES (882213, 'William', 'Blake', 'Essentiel avec publicité');
INSERT INTO Client_a VALUES (114455, 'Helena', 'Lovett', 'Supérieur');
INSERT INTO Client_a VALUES (446672, 'Jeanne', 'Moreau', 'Premium');

-- 3. Insertion des données dans `Visionnage_a`
INSERT INTO Visionnage_a VALUES (882213, '08-02-2024 00:06:00', 792307, 1, 31, '08-02-2024 00:41:00');
INSERT INTO Visionnage_a VALUES (882213, '08-02-2024 20:41:00', 792307, 1, NULL, '08-02-2024 23:49:00');
INSERT INTO Visionnage_a VALUES (114455, '14-02-2024 22:23:00', 398818, 4, NULL, '15-02-2024 00:34:00');
INSERT INTO Visionnage_a VALUES (114455, '15-02-2024 19:16:00', 398818, 2, 86, '15-02-2024 19:32:00');
INSERT INTO Visionnage_a VALUES (114455, SYSDATE-1, 7345, 3, 120, SYSDATE-22/24);
INSERT INTO Visionnage_a VALUES (114455, SYSDATE, 7345, 3, NULL, NULL);
INSERT INTO Visionnage_a VALUES (446672, SYSDATE, 496243, 5, NULL, NULL);

-- 4. Création et manipulation des vues

-- a. Vue `vvFilm` : Non modifiable en raison de la clause GROUP BY
CREATE VIEW vvFilm AS
SELECT idFilm, COUNT(numVersion) AS nbversion
FROM bdfilm.Version V
GROUP BY idFilm;

-- b. Vue `vRealisateur` : Non modifiable en raison de la jointure
CREATE VIEW vRealisateur AS
SELECT DISTINCT E.idPersonne, P.nomPersonne, P.prenomPersonne
FROM bdfilm.personne P
JOIN bdfilm.equipefilm E ON E.idPersonne = P.idPersonne
WHERE E.job='Director';

-- c. Vue `vvAuj` : Modifiable
CREATE VIEW vvAuj AS
SELECT *
FROM Visionnage_a
WHERE TRUNC(horoDatageDebut) = TRUNC(SYSDATE)
WITH CHECK OPTION;

-- Sélection des données de la vue `vvAuj`
SELECT *
FROM vvAuj;

-- Mise à jour de la vue `vvAuj`
UPDATE vvAuj
SET horoDatageDebut = TRUNC(SYSDATE-1)
WHERE idFilm = 496243;

-- Vérification des modifications
SELECT *
FROM vvAuj;

-- d. Vue `vClient` : Modifiable uniquement sur `numVersion`
CREATE VIEW vClient AS
SELECT c.nomClient, c.prenomClient, TO_CHAR(v.horoDatageDebut, 'DD-MM-YYYY') AS dateDebut, v.numVersion
FROM Client_a c
JOIN Visionnage_a v ON c.id_Client = v.id_Client;

-- Sélection des données de la vue `vClient`
SELECT *
FROM vClient;

-- e. Vue `vFilmAtt` : Modifiable sur 3 champs
CREATE VIEW vFilmAtt AS
SELECT c.nomClient, v.numVersion, TO_CHAR(v.horoDatageDebut, 'DD-MM-YYYY HH24:MI:SS') AS dateDebut, v.minuteStop
FROM Client_a c
JOIN Visionnage_a v ON c.id_Client = v.id_Client
WHERE v.minuteStop IS NOT NULL;
