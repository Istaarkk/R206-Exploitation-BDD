# Script SQL pour la gestion d'une base de données de campings

Ce script SQL permet de gérer une base de données comprenant des campings, des types de chalets, et des bases de loisirs. Le script couvre la création de tables, l'insertion de données, ainsi que diverses opérations de mise à jour et de suppression.

```sql
-- Suppression des tables existantes
DROP TABLE BaseLoisirs_abc CASCADE CONSTRAINTS;
DROP TABLE TypeChalet_abc CASCADE CONSTRAINTS;
DROP TABLE camping_abc CASCADE CONSTRAINTS;
DROP TABLE compoCamping_abc CASCADE CONSTRAINTS;

-- Création des tables

-- Table `BaseLoisirs_abc`
-- Cette table contient les informations sur les bases de loisirs.
CREATE TABLE BaseLoisirs_abc
(
    NumBaseL NUMBER(6) PRIMARY KEY NOT NULL,
    NomBaseL VARCHAR2(29) UNIQUE NOT NULL,
    AdrBaseL VARCHAR2(100) NOT NULL,
    CPBaseL INT NOT NULL,
    VilleBaseL VARCHAR2(25) NOT NULL
);

-- Table `TypeChalet_abc`
-- Cette table contient les types de chalets disponibles.
CREATE TABLE TypeChalet_abc
(
    NumTypeChalet NUMBER(6) PRIMARY KEY NOT NULL,
    NomTypeChalet VARCHAR2(20) UNIQUE NOT NULL,
    Capacite INT NOT NULL,
    Descr VARCHAR2(100)
);

-- Table `camping_abc`
-- Cette table contient les informations sur les campings.
CREATE TABLE camping_abc
(
    NumCamping NUMBER(6) PRIMARY KEY NOT NULL,
    NomCamping VARCHAR2(20) UNIQUE NOT NULL,
    AdrCamping VARCHAR2(45),
    CPCamping INT, 
    VilleCamping VARCHAR2(25),
    TelCamping VARCHAR2(25),
    BaseLoisirs INT,
    DateOuv DATE NOT NULL,
    DateFerm DATE NOT NULL,
    NbEtoiles INT CHECK(NbEtoiles >= 1 AND NbEtoiles <= 4),
    QualiteFrance CHAR(3) DEFAULT 'Non' CHECK(QualiteFrance IN ('Oui','Non')),
    CONSTRAINT DateOuv_DateFerm_Check CHECK (DateOuv <= DateFerm),
    FOREIGN KEY (BaseLoisirs) REFERENCES BaseLoisirs_abc(NumBaseL)
);

-- Table `compoCamping_abc`
-- Cette table relie les campings et les types de chalets, avec le nombre de chalets par type.
CREATE TABLE compoCamping_abc
(
    NumCamping NUMBER(6),
    NumTypeChalet NUMBER(6),
    NbreChalet INT CHECK(NbreChalet > 0),
    PRIMARY KEY (NumCamping, NumTypeChalet),
    FOREIGN KEY (NumCamping) REFERENCES camping_abc(NumCamping),
    FOREIGN KEY (NumTypeChalet) REFERENCES TypeChalet_abc(NumTypeChalet)
);

-- Insertion des données initiales à partir des tables d'un autre utilisateur
INSERT INTO BaseLoisirs_abc SELECT * FROM ffioren.BaseLoisirs;
INSERT INTO TypeChalet_abc SELECT * FROM ffioren.TypeChalet;
INSERT INTO camping_abc SELECT * FROM ffioren.Camping;
INSERT INTO compoCamping_abc SELECT * FROM ffioren.CompoCamping;

-- Mise à jour des dates d'ouverture et de fermeture pour l'année 2024
UPDATE camping_abc
SET DateOuv = TO_DATE('2024' || TO_CHAR(DateOuv, 'MMDD'), 'YYYYMMDD'),
    DateFerm = TO_DATE('2024' || TO_CHAR(DateFerm, 'MMDD'), 'YYYYMMDD');

-- Ajout d'un nouveau camping trois étoiles "Les Flots Bleus"
INSERT INTO camping_abc VALUES (20, 'Les Flots Bleus', NULL, NULL, NULL, NULL, NULL, '01 01 24', '31 12 24', 3, 'Oui');
INSERT INTO compoCamping_abc (NumCamping, NumTypeChalet, NbreChalet)
SELECT 20, NumTypeChalet, 1
FROM TypeChalet_abc;

-- Ajout d'un nouveau camping quatre étoiles "Les Dents de la Mer" avec un numéro auto-incrémenté
INSERT INTO camping_abc (NumCamping, NomCamping, AdrCamping, CPCamping, VilleCamping, TelCamping, DateOuv, DateFerm, NbEtoiles, QualiteFrance)
VALUES ((SELECT MAX(NumCamping) + 1 FROM camping_abc), 'Les Dents de la Mer', NULL, NULL, NULL, NULL, '05 07 24', '31 08 24', 4, 'Non');
INSERT INTO compoCamping_abc (NumCamping, NumTypeChalet, NbreChalet)
SELECT (SELECT MAX(NumCamping) FROM camping_abc), NumTypeChalet, 1
FROM TypeChalet_abc;

-- Ajout d'un chalet numéro 6 à tous les campings affiliés à la base de loisirs "La Maladrerie"
INSERT INTO compoCamping_abc (NumCamping, NumTypeChalet, NbreChalet)
SELECT NumCamping, 6, 1
FROM camping_abc
WHERE BaseLoisirs = (SELECT NumBaseL FROM BaseLoisirs_abc WHERE NomBaseL = 'La Maladrerie')
AND NOT EXISTS (
    SELECT 1
    FROM compoCamping_abc
    WHERE compoCamping_abc.NumCamping = camping_abc.NumCamping
    AND compoCamping_abc.NumTypeChalet = 6
);

-- Suppression des campings non affiliés à une base de loisirs
DELETE FROM compoCamping_abc WHERE NumCamping IN (SELECT NumCamping FROM camping_abc WHERE BaseLoisirs IS NULL);
DELETE FROM camping_abc WHERE BaseLoisirs IS NULL;
