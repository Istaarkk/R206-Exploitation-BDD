# Requêtes SQL - Exercices

Ce document contient des requêtes SQL répondant à plusieurs exercices portant sur la manipulation et la gestion de données dans une base de données de films.

```sql
-- Exercice 1

-- a) Sélectionner les films qui n'ont pas été distribués en France
SELECT idfilm, titre
FROM bdfilm.FILM F
WHERE F.idfilm NOT IN (SELECT idfilm
                       FROM bdfilm.SORTIE S
                       WHERE S.codePays = 'FR');

-- b) Sélectionner les personnes qui ne sont ni acteurs ni réalisateurs
SELECT DISTINCT P.nomPersonne, P.prenomPersonne
FROM bdfilm.Personne P
WHERE P.idPersonne NOT IN (SELECT idPersonne FROM bdfilm.rolefilm)
  AND P.idPersonne NOT IN (SELECT idPersonne FROM bdfilm.equipefilm EF WHERE EF.job = 'Director')
ORDER BY P.nomPersonne;

-- c) Sélectionner les réalisateurs ayant dirigé plus de films que ceux dans lesquels ils ont joué
SELECT nomPersonne, prenomPersonne
FROM bdfilm.personne P
INNER JOIN bdfilm.equipefilm EF ON P.idPersonne = EF.idPersonne
WHERE EF.job = 'Director'
GROUP BY P.idPersonne, nomPersonne, prenomPersonne
HAVING COUNT(DISTINCT EF.idFilm) > (SELECT COUNT(DISTINCT RF2.idFilm)
                                    FROM bdfilm.rolefilm RF2
                                    INNER JOIN bdfilm.personne P2 ON P2.idPersonne = RF2.idPersonne
                                    WHERE P2.idPersonne = P.idPersonne)
ORDER BY P.nomPersonne;

-- d) Compter le nombre de réalisateurs qui ont également joué dans un film
SELECT COUNT(DISTINCT idPersonne) AS "nombre de réa"
FROM bdfilm.equipefilm EF
WHERE EF.job = 'Director'
  AND idPersonne IN (SELECT idPersonne FROM bdfilm.rolefilm RF);

-- Exercice 2

-- a) Créer une vue `vFilm` qui affiche le nombre de sorties par film
DROP VIEW IF EXISTS vFilm;

CREATE VIEW vFilm AS
SELECT idFilm, COUNT(*) AS "nbr sortie"
FROM bdfilm.sortie
GROUP BY idFilm;

-- b) Créer des vues pour les réalisateurs et les acteurs
DROP VIEW IF EXISTS vActeur;

CREATE VIEW vActeur AS
SELECT idPersonne, nomPersonne, prenomPersonne
FROM bdfilm.equipefilm EF
NATURAL JOIN bdfilm.personne
WHERE EF.job = 'Director'
ORDER BY nomPersonne;

-- La vue `vActeur` n'est pas modifiable en raison du JOIN

DROP VIEW IF EXISTS vActeur2;

CREATE VIEW vActeur2 AS
SELECT idPersonne, nomPersonne, prenomPersonne
FROM bdfilm.rolefilm RF
NATURAL JOIN bdfilm.personne P
ORDER BY nomPersonne;

-- La vue `vActeur2` n'est pas modifiable car tous les attributs ne proviennent pas d'une seule table

SELECT * FROM vActeur2 WHERE nomPersonne = 'Howard';

-- c) Requêtes pour comparer les résultats des vues `vActeur` et `vActeur2`
SELECT prenomPersonne
FROM vActeur
WHERE nomPersonne = 'Howard'; -- Pas de résultats

SELECT prenomPersonne
FROM vActeur2
WHERE nomPersonne = 'Howard'; -- 4 résultats

-- d) Créer une vue `vFilmReal` pour afficher les films avec leurs réalisateurs
DROP VIEW IF EXISTS vFilmReal;

CREATE VIEW vFilmReal AS
SELECT idFilm, titre, idPersonne, nomPersonne, prenomPersonne
FROM bdfilm.FILM F
NATURAL JOIN bdfilm.equipefilm EF
NATURAL JOIN bdfilm.personne P
WHERE EF.job = 'Director'
ORDER BY titre;

-- La vue `vFilmReal` n'est pas modifiable en l'état

-- Les commandes suivantes ne sont pas possibles :
-- UPDATE vFilmReal SET idPersonne = 6 WHERE titre = 'Call Me by Your Name'; -- Erreur : Impossible de modifier une colonne issue d'une table sans clé primaire
-- UPDATE vFilmReal SET titreOriginal = 'Otto e mezzo' WHERE idFilm = 422; -- Erreur d'identificateur non valide
-- DELETE FROM vFilmReal WHERE nomPersonne = 'Aronofsky'; -- Erreur : Privilèges insuffisants

-- Requête pour vérifier la vue `vFilmReal`
SELECT titre
FROM vFilmReal
WHERE nomPersonne = 'Tarantino';
